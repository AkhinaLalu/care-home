{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>CAREHOME </title>
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <meta content="" name="keywords">
        <meta content="" name="description">
        <!-- Favicon -->
        <link href="img/favicon.ico" rel="icon">
        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Nunito:wght@600;700;800&display=swap" rel="stylesheet">
        <!-- Icon Font Stylesheet -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <!-- Customized Bootstrap Stylesheet -->
        <link href="{% static 'assets/css/bootstrap.min.css' %}" rel="stylesheet">

        <!-- Libraries Stylesheet -->

        <!-- Customized Bootstrap Stylesheet -->
        <link href="{% static 'admin_template/assets/css/bootstrap.min.css' %}" rel="stylesheet">

        <!-- Template Stylesheet -->
        <link href="{% static 'assets/css/style.css' %}" rel="stylesheet">
        <script src="{% static 'assets/js/jquery.min.js' %}"></script>
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        {% comment %} <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script> {% endcomment %}
        <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Template Javascript -->
        <script src="{% static 'assets/js/main.js' %}"></script>
        <script src="{% static 'admin_template/assets/js/authentication-main.js' %}"></script>
        <link id="style" href="{% static 'admin_template/assets/libs/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet" >

        <!-- Icons Css -->
        <link href="{% static 'admin_template/assets/css/icons.css' %}" rel="stylesheet" >

        <link rel="stylesheet" href="{% static 'admin_template/assets/libs/tarekraafat/autocomplete.js/css/autoComplete.css' %}">
        <link rel="stylesheet" href="{% static 'admin_template/assets/libs/intl-tel-input/build/css/intlTelInput.min.css' %}">

        
        <!-- intl-tel-input css -->
        <link rel="stylesheet" href="{% static 'admin_template/assets/libs/intl-tel-input/build/css/intlTelInput.min.css' %}">

        <!-- Tagify CSS -->
        <link rel="stylesheet" href="{% static 'admin_template/assets/libs/@yaireo/tagify/tagify.css' %}">
        
        <!-- Dragsort CSS -->
        <link rel="stylesheet" href="{% static 'admin_template/assets/libs/@yaireo/dragsort/dragsort.css' %}">

        
        <!-- Style Css -->
        <link href="{% static 'admin_template/assets/css/styles.css' %}" rel="stylesheet" >
        <link href="{% static  'admin_template/assets/css/staff.css' %}" rel="stylesheet" >
         <!-- Dual ListBox CSS -->
        <link rel="stylesheet" href="{% static 'admin_template/assets/libs/dual-listbox/dual-listbox.css' %}">
        <link rel="stylesheet" href="{% static 'admin_template/assets/libs/prismjs/themes/prism-coy.min.css' %}">
        <script src="{% static 'admin_template/assets/libs/choices.js/public/assets/scripts/choices.min.js' %}"></script>
        <link rel="stylesheet" href="{% static 'admin_template/assets/libs/choices.js/public/assets/styles/choices.min.css' %}">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
        </head>
    


    <body class="authenticationss-background">
        <!-- Navbar Start -->
        <!-- Navbar End -->
        <!-- Callback Start -->
        <div class="container-fluid callback " >
        <div class="container pt-5 " >
            <div class="row justify-content-center cards custom-card">
                <div class="col-lg-12" >
                    <div class="  rounded p-4 p-sm-5 wow fadeInUp" data-wow-delay="0.5s" style="background-color: none!important;border-color: none!important;">
                        <div class="text-center mx-auto wow fadeInUp" data-wow-delay="0.1s" style="max-width: 600px;">
                            <h1 class="m-0 text-primary" ><img src="{% static 'assets/image/circle.jpg' %}" style="width:45%;"></h1>
                            <br>
                            <h3 style="color:#1a0dab;font-weight:bold">Welcome to Care Circle Ltd</h3>
                            <p style="color:#1a0dab;">We're glad you're here :) So we can get you set up and running ;please enter the following details</p>
                            <br>
                        </div>
                        <form action="{% url 'staff-register' %}" method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="row gy-4">
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                                    <label for="input-label" class="form-label">First Name</label>
                                    <input type="text" class="form-control" id="input" name="first_name">
                                        {% if errors.first_name %}
                                        <small class="text-danger">{{ errors.first_name }}</small>
                                    {% endif %}
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                                    <label for="input-label" class="form-label">Last Name</label>
                                    <input type="text" class="form-control" id="input-label" name="last_name">
                                    {% if errors.last_name %}
                                        <small class="text-danger">{{ errors.last_name }}</small>
                                    {% endif %}
                                </div>
                                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-6">
                                    <label for="email-input" class="form-label">Email Address</label>
                                    <input type="text" class="form-control" id="email-input" name="email_id" placeholder="Enter your email">
                                    {% if errors.email_id %}
                                        <small class="text-danger">{{ errors.email_id }}</small>
                                    {% endif %}
                                    <!-- OTP Input (Initially Hidden) -->
                                    <div id="otp-container" style="display: none; margin-top: 10px;">
                                        <input type="text" class="form-control" id="otp-input" placeholder="Enter OTP">
                                        <!-- Submit Button -->
                                        <button type="button" class="btn btn-success mt-2" onclick="verifyOTP()">Submit</button>
                                    </div>
                                </div>
                                <div class="col-xl-2 col-lg-2 col-md-2 col-sm-6">
                                    <br>
                                    <input type="button" id="verify-btn" class="btn btn-primary" value="Verify" onclick="sendOTP()">
                                </div>
                                <div class="col-xl-2 col-lg-2 col-md-2 col-sm-6" id="otp-verify-container" style="display: none;">
                                    <br>
                                    <input type="button" id="otp-verify-btn" class="btn btn-success" value="Submit OTP" onclick="verifyOTP()">
                                </div>
                                <div class="col-xl-2 col-lg-2 col-md-2 col-sm-6">
                                    <label for="input-text"  class="form-label">Country Code</label>
                                    {% comment %} <input type="tel" class="form-control" name="cntry-code" id="input-tel" placeholder="+1"> {% endcomment %}
                                    <select class="form-control" name="cntry-code" id="t" required>
                                        <option value="+1">+1</option>
                                        <option value="+2">+2</option>
                                        <option value="+91">+91</option>
                                        <option value="+6">+6</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-2 col-md-2 col-sm-6">
                                    <label for="input-text"  class="form-label">Phone Number</label>
                                    <input type="tel" class="form-control" name="ph_number" id="input-tel" placeholder="2031-1233">
                                    {% if errors.ph_number %}
                                        <small class="text-danger">{{ errors.ph_number }}</small>
                                    {% endif %}
                                </div>
                                <div class="col-xl-2 col-lg-2 col-md-2 col-sm-6"><br>
                                    {% comment %} <input type="submit" name="save" id="save" class="btn  me-2" value="Verify" onclick="validate()"> {% endcomment %}
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                                    <label for="input-number"  class="form-label">Enter a Password</label>
                                    <input type="password" class="form-control" name="psw1" id="input-password" placeholder="Password">
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                                    <label for="input-password"  class="form-label">Confirm Password</label>
                                    <input type="password" class="form-control" name="psw2" id="input-password" placeholder="Password">
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                                    <label class="form-label d-block" >Job Applying For</label>
                                    <select class="form-control" name="job_apply" id="choices-single-default" required>
                                        <option value="">This is a placeholder</option>
                                        <option value="Choice 1">Choice 1</option>
                                        <option value="Choice 2">Choice 2</option>
                                        <option value="Choice 3">Choice 3</option>
                                    </select>
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                                    <label for="input-date" class="form-label">Date of birth</label>
                                    <input type="date"  name="dob" class="form-control" id="input-date">
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                                    <label for="choices-multiple-default" class="form-label">Preferred areas to work</label>
                                    <select class="form-control" name="preferred_areas" id="choices-multiple-default" multiple>
                                        <option value="Choice 1" selected>Choice 1</option>
                                        <option value="Choice 2">Choice 2</option>
                                        <option value="Choice 3">Choice 3</option>
                                        <option value="Choice 4">Choice 4</option>
                                        <option value="Choice 5">Choice 5</option>
                                        <option value="Choice 6" disabled>Choice 6</option>
                                    </select>
                                </div>
                                <div class="col-xl-2 col-lg-2 col-md-2 col-sm-6">
                                    <label for="input-week" class="form-label">House Number</label>
                                    <input type="text" class="form-control" id="input" name="house_number">
                                </div>
                                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-6">
                                    <label for="input-week" class="form-label">Address</label>
                                    <textarea class="form-control" id="input" name="address"></textarea>
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                                    <label for="input-month" class="form-label">Nationality</label>
                                    <input type="text" class="form-control" id="input" name="nationality">
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                                    <label for="gender" class="form-label">Gender</label>
                                    <select class="form-control" name="gender" id="gender" required>
                                        <option value="">Select Gender</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <input type="hidden" value="<?= $files ?>" name="old_files" id="old_files">
                            <div class="row gy-4">
                                <!-- Image Upload Section -->
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12" id="image-div">
                                    <br>
                                    <label for="exampleInputFile">Your Image <span style="color: #e09d1d;">(Max-size up to 1MB)</span></label>
                                    <div class="input-group">
                                        <div class="custom-file">
                                            <input type="file" name="image" class="form-control imgupload" id="files" 
                                                accept="image/png, image/jpeg, image/jpg" onchange="validateImage(); previewImage(event, 'uploadfile', true)">
                                        </div>
                                    </div>
                                    <div id="uploadfile"></div>
                                    <div id="image-resolution" style="margin-top: 10px; color: #e09d1d;"></div>
                                    <div id="error-message" style="margin-top: 10px; color: #e09d1d;"></div>
                                </div>
                                <!-- Certificate Upload Section -->
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12" id="certificate-div">
                                    <br>
                                    <label for="exampleInputFile">Certificates <span style="color: #e09d1d;">(Max-size up to 1MB each)</span></label>
                                    <div id="certificate-container">
                                        <!-- Default Certificate Input (No Close Button) -->
                                        <div class="input-group certificate-input">
                                            <div class="custom-file">
                                                <input type="file" name="certificate[]" class="form-control certificateupload"
                                                    accept="image/png, image/jpeg, image/jpg" onchange="validateCertificate(event, this)" multiple>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Add New Certificate Button -->
                                    <button type="button" class="btn btn-success mt-2" onclick="addCertificateInput()">+ Add Certificate</button>
                                    <!-- Certificate Previews -->
                                    <div id="uploadcertificate"></div>
                                </div>
                            </div>
                            <div class="form-check mb-2"><br>
                                <input class="form-check-input" type="checkbox" value="" id="primaryChecked" checked="" required>
                                <label class="form-check-label" for="primaryChecked">
                                By registering, I agree to the <span style="color:rgb(88 155 255)">Terms of Employement & Privacy Policy</span> of Care Circle Ltd
                                </label>
                            </div>
                            <div class="form-group">
                                <div class="form-group">
                                    <div class="captcha-container" style="display: flex; align-items: center; gap: 10px;">
                                        <div id="captcha-display" class="captcha-box"
                                            style="border: 1px solid #ddd;
                                                    padding: 10px;
                                                    border-radius: 0.25rem;
                                                    background: url('https://www.transparenttextures.com/patterns/cartographer.png') !important; 
                                                    background-size: cover;
                                                    font-size: 16px;
                                                    font-weight: bold;
                                                    letter-spacing: 10px;
                                                    width: 150px;
                                                    text-align: center;
                                                    user-select: none;
                                                    display: flex;
                                                    align-items: center;
                                                    justify-content: center;">
                                        </div>
                                        <button type="button" class="btn btn-primary refreshCaptcha">
                                            <i class="bi bi-arrow-clockwise"></i>
                                        </button>
                                    </div>
                                    
                                </div>
                                <div class="form-group">
                                    <div class="col-md-6">
                                        <div id="captcha-display">
                                            <!-- Generated code will appear here -->
                                        </div>
                                        <label class="control-label">Enter the above text</label>
                                        <input type="text" id="captcha" name="captcha" value="" class="form-control" oninput="this.value = this.value.replace(/[^0-9]/g, '')" required>
                                    </div>
                                </div>
                                <center> <input type="submit" name="save" id="save" class="btn  me-2" value="Submit" style="background:#589bff;">
                                    <a href="<?= base_url() ?>index.php/Online_member_register" class="btn btn-danger">Cancel</a><br><span style="color:red;font-size:12px">Please note all fields are mandatory fields.</span>
                                </center>
                        </form>
                        <br>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Callback End -->
        <!-- Back to Top -->
        <!-- JavaScript Libraries -->
        <script src="{% static 'assets/js/prism-custom.js' %}"></script>
        <!-- Internal Choices JS -->
        <script src="{% static 'assets/js/choices.js' %}"></script>
        <!-- Custom JS -->
        <script src="{% static 'assets/js/custom.js' %}"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                new Choices("#choices-multiple-default", {
                    removeItemButton: true,
                });
            });
        </script>
    
        <script>
            function generateCaptcha() {
                let code = "";
                let chars = "0123456789"; // Only numbers
                for (let i = 0; i < 5; i++) {
                    code += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                document.getElementById("captcha-display").textContent = code;
            }
            
            // Generate captcha on page load
            generateCaptcha();
            
            // Refresh captcha when the button is clicked
            document.querySelector(".refreshCaptcha").addEventListener("click", generateCaptcha);
        </script>
        <!-- JavaScript for Preview, Remove, and Add Options -->
        <script>
            function validateImage() {
                const fileInput = document.getElementById('files');
                const resolutionDiv = document.getElementById('image-resolution');
                
                resolutionDiv.innerHTML = ''; // Clear previous messages
                
                const file = fileInput.files[0];
                if (!file) return;
            
                const allowedExtensions = ['image/jpeg', 'image/jpg', 'image/png'];
                const maxSize = 1 * 1024 * 1024; // 1MB in bytes
            
                if (!allowedExtensions.includes(file.type)) {
                    fileInput.value = ''; // Reset file input if invalid file type
                    alert("Invalid file type. Please upload a JPG or PNG image.");
                    return;
                }
            
                if (file.size > maxSize) {
                    fileInput.value = ''; // Reset file input if the size exceeds 1MB
                    resolutionDiv.innerHTML = '<b>File size exceeds 1MB. Please upload a smaller image.</b>';
                    resolutionDiv.style.color = 'red';
                    return;
                }
            
                const img = new Image();
                img.src = URL.createObjectURL(file);
                img.onload = function () {
                    resolutionDiv.innerHTML = `Size: ${img.width}x${img.height} Pixels`;
                    URL.revokeObjectURL(img.src);
                };
            }
            
            function validateCertificate(event, inputElement, previewId) {
                var file = event.target.files[0];
                if (!file) return;
            
                const allowedExtensions = ['image/jpeg', 'image/jpg', 'image/png'];
                const maxSize = 1 * 1024 * 1024; // 1MB in bytes
            
                if (!allowedExtensions.includes(file.type)) {
                    inputElement.value = ''; // Reset input if invalid file type
                    alert("Invalid file type. Please upload a JPG or PNG certificate.");
                    return;
                }
            
                if (file.size > maxSize) {
                    inputElement.value = ''; // Reset input if file size exceeds 1MB
                    alert("File size exceeds 1MB. Please upload a smaller certificate.");
                    return;
                }
            
                previewCertificates(event, inputElement, previewId);
            }
            function previewImage(event, previewDivId, single = false) {
                var file = event.target.files[0];
            
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        var previewHTML = `
                            <div style="position: relative; display: inline-block; margin-top: 10px;">
                                <img src="${e.target.result}" style="max-width: 135px; max-height: 135px; border: 1px solid #ddd; padding: 5px;">
                                <button onclick="removePreview('${previewDivId}')" style="position: absolute; top: -5px; right: -5px; background: red; color: white; border: none; cursor: pointer;">✖</button>
                            </div>
                        `;
                        document.getElementById(previewDivId).innerHTML = single ? previewHTML : document.getElementById(previewDivId).innerHTML + previewHTML;
                    };
                    reader.readAsDataURL(file);
                }
            }
            
            function previewCertificates(event, inputElement, previewId) {
                var file = event.target.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        var previewHTML = `
                            <div id="${previewId}" style="position: relative; display: inline-block; margin: 10px;">
                                <img src="${e.target.result}" style="max-width: 135px; max-height: 135px; border: 1px solid #ddd; padding: 5px;">
                                <button onclick="removePreview('${previewId}')" style="position: absolute; top: -5px; right: -5px; background: red; color: white; border: none; cursor: pointer;">✖</button>
                            </div>
                        `;
                        document.getElementById('uploadcertificate').innerHTML += previewHTML;
                    };
                    reader.readAsDataURL(file);
                }
            }
            
            function addCertificateInput() {
                var container = document.getElementById("certificate-container");
                
                var inputDiv = document.createElement("div");
                inputDiv.classList.add("input-group", "certificate-input", "mt-2");
            
                var uniqueId = `cert-${Date.now()}`; // Unique ID for input and preview
            
                inputDiv.innerHTML = `
                    <div class="custom-file">
                        <input type="file" name="certificate[]" class="form-control certificateupload"
                               accept="image/png, image/jpeg, image/jpg" id="${uniqueId}" onchange="validateCertificate(event, this, '${uniqueId}')">
                    </div>
                    <button type="button" class="btn btn-danger" onclick="removeCertificateInput(this, '${uniqueId}')">✖</button>
                `;
            
                container.appendChild(inputDiv);
            }
            
            function removeCertificateInput(button, previewId) {
                button.parentElement.remove(); // Remove the input field
                var previewElement = document.getElementById(previewId);
                if (previewElement) {
                    previewElement.remove(); // Remove the corresponding preview
                }
            }
            
            
            function removePreview(previewId) {
                var previewElement = document.getElementById(previewId);
                if (previewElement) {
                    previewElement.remove(); // Remove preview when clicking the "✖" button
                }
            }
        </script>
        <script>
            let generatedOTP = "";
            function sendOTP() {
                const email = document.getElementById("email-input").value.trim();
            
                if (!validateEmail(email) || email === '') {
                    alert("Please enter a valid email address.");
                    return;
                }
            
                // Show OTP input field only after validation passes
                document.getElementById('otp-container').style.display = 'block';
            
                // Generate a random 6-digit OTP
                generatedOTP = Math.floor(100000 + Math.random() * 900000).toString();
                alert(generatedOTP);
            
                // Send OTP to Django backend
                fetch("/send-otp/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": getCSRFToken() // Include CSRF token
                    },
                    body: JSON.stringify({
                        email: email,
                        otp: generatedOTP
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert("OTP has been sent to your email!");
                        document.getElementById("otp-container").style.display = "block"; // Show OTP input field
                    } else {
                        alert("Error sending OTP. Please try again.");
                    }
                });
            }
            
            
            function verifyOTP() {
                const enteredOTP = document.getElementById("otp-input").value.trim();
                const verifyBtn = document.getElementById("verify-btn");
                console.log("Verify button:", verifyBtn); // Debugging line
            
                if (enteredOTP === generatedOTP) {
                    alert("OTP Verified Successfully!");
            
                    if (verifyBtn) { // Check if the button exists
                        verifyBtn.innerHTML = "✅ Verified";
                        verifyBtn.classList.remove("btn-primary");
                        verifyBtn.classList.add("btn-success");
                        verifyBtn.disabled = true;
                    }
            
                    // Hide OTP input field
                    document.getElementById("otp-container").style.display = "none";
                } else {
                    alert("Invalid OTP! Please try again.");
                }
            }
            
                function validateEmail(email) {
                    // Basic email validation regex
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    return emailRegex.test(email);
                }
        </script>
    </body>
</html>